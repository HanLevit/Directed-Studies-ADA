
### Loading Libraries 
```{r}
library(ggplot2)
library(tidyverse)
library(DHARMa)
library(mgcv)
library(fitdistrplus)
library(goft)
library(gamlss)
library(patchwork)
library(MASS)
# do i need all of these?
```


### ALARIA ###

### SPORE SETTLEMENT TRIAL 1

```{r}
# loading all alaria measurements 
alaria_trial_all_data = read.csv("data/alaria_trials_combined.csv")

# parsing data such that only trial 1 is present 
    # Note: trial one is now the combination of trial 1 and trial 2 because they
          # both used the same batch of spores
alaria_trial1_2_data <- alaria_trial_all_data %>%
  filter(Trial == "1" | Trial == "2", .preserve = FALSE)

```

```{r}
my_cols1 = c("Sound A" = "khaki2", "Sound B" = "khaki1", "Control A-B" = "indianred3")

ggplot(alaria_trial1_2_data, aes(x = Treatment, y = Settlement, fill = Treatment)) + 
  geom_point(aes(colour = Treatment), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.6) +
  scale_color_manual(values = my_cols1) +
  scale_fill_manual(values = my_cols1) + 
  theme_classic() +
  labs(x = "Trial 1", y = "Spore Settlement") +
  theme(axis.title = element_text(size = 10)) +
  scale_x_discrete(labels = c("Control", "20 kHz A", "20 kHz B")) +
  theme(legend.position = "none") 

```

```{r}
alaria_trial1.mod <- lm(Settlement ~ Treatment, data = alaria_trial1_2_data)
summary(alaria_trial1.mod)
```
Adjusted R-squared:  0.07692 
F-statistic: 6.042 on 2 and 119 DF,  p-value: 0.003169

                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)        14.975      1.105  13.551  < 2e-16 ***
TreatmentSound A    3.400      1.563   2.176 0.031565 *  
TreatmentSound B    5.311      1.544   3.439 0.000805 ***

```{r}
shapiro.test(alaria_trial1_2_data$Settlement)
```
W = 0.99451, p-value = 1
NORMAL

                        
```{r}
# Running a Two-Factor anova 
# ask if unnessecary due to linear model giving mostly same info
alaria_trial1.aov <- aov(Settlement ~ Treatment, data = alaria_trial1_2_data)
summary(alaria_trial1.aov)
```
             Df Sum Sq Mean Sq F value  Pr(>F)   
Treatment     2    590  295.13   6.042 0.00317 **
Residuals   119   5813   48.85    

```{r}
# testing for variance - doesn't work with three variables
bartlett.test(Settlement ~ Treatment, data = alaria_trial1_2_data)
```
F = 1.2111, num df = 7, denom df = 15, p-value = 0.7103
95 percent confidence interval: 0.3677548 5.5322698
ratio of variances: 1.211149 


### ALARIA SETTLEMENT TRIAL 2

```{r}
alaria_trial_all_data = read.csv("data/alaria_trials_combined.csv")

alaria_trial3_4_data <- alaria_trial_all_data %>%
  filter(Trial == "3" | Trial == "4", .preserve = FALSE)

```

```{r}
my_cols2 = c("Sound C" = "khaki2","Sound D" = "khaki1", "Control C-D" = "indianred3")

ggplot(alaria_trial3_4_data, aes(x = Treatment, 
                                 y = Settlement, fill = Treatment)) + 
  geom_point(aes(colour = Treatment), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.7) +
  scale_color_manual(values = my_cols2) +
  scale_fill_manual(values = my_cols2) + 
  theme_classic() +
  labs(x = "Trial 2", y = "Spore Settlement") +
  theme(axis.title = element_text(size = 10)) +
  scale_x_discrete(labels = c("Control", "20 kHz A", "20 kHz B")) +
  theme(legend.position = "none") 
  
```


```{r}
shapiro.test(alaria_trial3_4_data$Settlement)
```
W = 0.96034, p-value = 0.001273
not normal

```{r}
transformed_trial3_4_data <- alaria_trial3_4_data %>%
  mutate(logSettlement = log(Settlement))

shapiro.test(transformed_trial3_4_data$logSettlement)
# W = 0.99172, p-value = 0.689
```

```{r}
alaria_trial2.mod <- lm(logSettlement ~ Treatment, data = transformed_trial3_4_data)
summary(alaria_trial2.mod)
```
Adjusted R-squared:  0.05553 
F-statistic: 4.528 on 2 and 118 DF,  p-value: 0.01274

                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)       3.21518    0.04903  65.575  < 2e-16 ***
TreatmentSound C  0.15543    0.07066   2.200  0.02978 *  
TreatmentSound D  0.20094    0.07020   2.862  0.00498 **



```{r}
t.test(Settlement ~ Treatment, data = alaria_trial3_4_data, 
       alternative = "two.sided", var.equal = T, conf.level = 0.95)

# assuming normality testing similarity of means
```
t = -2.0839, df = 22, p-value = 0.049
95 percent confidence interval:  -5.929492 -0.014258
mean in group Control   mean in group Sound 
             12.80000              15.77187
                     
                        
```{r}
alaria_trial2.aov <- aov(logSettlement ~ Treatment, data = transformed_trial3_4_data)
summary(alaria_trial2.aov)
```
             Df Sum Sq Mean Sq F value Pr(>F)  
Treatment     2  0.914  0.4572   4.528 0.0127 *
Residuals   118 11.914  0.1010    

```{r}
var.test(Settlement ~ Treatment, data = alaria_trial3_4_data, 
         alternative = "two.sided")
```
F = 0.35858, num df = 7, denom df = 15, p-value = 0.1751
95 percent confidence interval: 0.1088801 1.6379241
ratio of variances: 0.3585815 

----------------------------------------------------------------------

### COMBINED DATA 
```{r}
alaria_trial_all_data = read.csv("data/alaria_trials_combined.csv")

alaria_trial_all.mod <- lm(Settlement ~ Treatment, data = alaria_trial_all_data)
summary(alaria_trial_all.mod)
```
Adjusted R-squared:  0.139 
F-statistic: 8.588 on 1 and 46 DF,  p-value: 0.005253

               Estimate Std. Error t value Pr(>|t|)    
(Intercept)      13.887      1.026  13.531  < 2e-16 ***
TreatmentSound    3.684      1.257   2.931  0.00525 **

```{r}
shapiro.test(alaria_trial_all_data$Settlement)

transformed_alaria_all_data <- alaria_trial_all_data %>%
  mutate(logSettlement = log(Settlement)) %>%
  subset(select = c(Treatment, logSettlement, Time, Tank))
  

shapiro.test(transformed_alaria_all_data$logSettlement)
# W = 0.98838, p-value = 0.04697
# still not normal
```
W = 0.95681, p-value = 1.154e-06
not normal
log transformed:
W = 0.98838, p-value = 0.04697

```{r}
fitDist(logSettlement, data = transformed_alaria_all_data, type = "realAll", try.gamlss = T) 
# didn't run??

#Family:  c("WEI", "Weibull") 
#Fitting method: "nlminb" 

# visualizing the distribution in a histogram
histDist(transformed_alaria_all_data$logSettlement, "WEI")
```


```{r}

alaria_combined.mod <- gamlss(logSettlement ~ Treatment, data = transformed_alaria_all_data, family = "WEI")
summary(alaria_combined.mod)


# assuming normality testing similarity of means
```
                     Estimate Std. Error t value Pr(>|t|)    
(Intercept)           1.05119    0.01723  61.018  < 2e-16 ***
TreatmentControl C-D  0.14065    0.02359   5.963 8.96e-09 ***
TreatmentSound A      0.06371    0.02370   2.688  0.00770 ** 
TreatmentSound B      0.07787    0.02349   3.315  0.00106 ** 
TreatmentSound C      0.19714    0.02398   8.222 1.34e-14 ***
TreatmentSound D      0.21667    0.02381   9.101  < 2e-16 ***

```{r}
alaria_combined.mod <- gamlss(logSettlement ~ Treatment + Tank, data = transformed_alaria_all_data, family = "WEI")
summary(alaria_combined.mod)

alaria_combined.mod <- gamlss(logSettlement ~ Treatment + Time, data = transformed_alaria_all_data, family = "WEI")
summary(alaria_combined.mod)
```

```{r}

```


```{r}
library(car)
# testing variance when we cannot assume normality 

leveneTest(Settlement ~ Treatment, data = alaria_trial_all_data)
```
t = -2.9306, df = 46, p-value = 0.005253
95 percent confidence interval: -6.214167 -1.153542
sample estimates:
mean in group Control   mean in group Sound 
             13.88750              17.57135 
                     

```{r}
var.test(Settlement ~ Treatment, data = alaria_trial_all_data, 
         alternative = "two.sided")
```
F = 0.73148, num df = 15, denom df = 31, p-value = 0.529
95 percent confidence interval:  0.3193237 1.9283757
ratio of variances: 0.7314804 

------------------------------------------------------------------------------

### ALL FOUR TRIALS IN ONE FIGURE

```{r}
library(patchwork)
library(ggplot2)

my_cols1 = c("Sound A" = "khaki2", "Sound B" = "khaki1", "Control A-B" = "indianred3")
my_cols2 = c("Sound C" = "khaki2","Sound D" = "khaki1", "Control C-D" = "indianred3")
my_cols3 = c("Sound" = "khaki2", "Control" = "indianred3")

alaria_trial_all_data = read.csv("data/alaria_trials_combined.csv")

alaria_trial3_4_data <- alaria_trial_all_data %>%
  filter(Trial == "3" | Trial == "4", .preserve = FALSE)

alaria_trial1_2_data <- alaria_trial_all_data %>%
  filter(Trial == "1" | Trial == "2", .preserve = FALSE)

alaria_treatment_control = read.csv("data/alaria_all_treat_v_control.csv")

```

```{r}
# loading all graphs 
alaria_trial1_2_graph = ggplot(alaria_trial1_2_data, 
                             aes(x = Treatment, y = Settlement, fill = Treatment)) + 
  geom_point(aes(colour = Treatment), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.6) +
  scale_color_manual(values = my_cols1) +
  scale_fill_manual(values = my_cols1) + 
  theme_classic() +
  labs(x = "Trial 1", y = "Spore Settlement") +
  theme(axis.title = element_text(size = 13)) +
  scale_x_discrete(labels = c("Control", "20 kHz A", "20 kHz B")) +
  theme(legend.position = "none") 

alaria_trial3_4_graph = ggplot(alaria_trial3_4_data, 
                             aes(x = Treatment, y = Settlement, fill = Treatment)) + 
  geom_point(aes(colour = Treatment), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.6) +
  scale_color_manual(values = my_cols2) +
  scale_fill_manual(values = my_cols2) + 
  theme_classic() +
  labs(x = "Trial 2", y = "Spore Settlement") +
  theme(axis.title = element_text(size = 13)) +
  scale_x_discrete(labels = c("Control", "20 kHz A", "20 kHz B")) +
  theme(legend.position = "none") 


combined_graph = ggplot(alaria_treatment_control, aes(x = Treatment, y = Settlement, fill = Treatment)) + 
  geom_point(aes(colour = Treatment), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.6) +
  scale_color_manual(values = my_cols3) +
  scale_fill_manual(values = my_cols3) + 
  theme_classic() +
  labs(x = "Alaria marginata Combined Data", y = "Spore Settlement") +
  theme(axis.title = element_text(size = 13)) +
  scale_x_discrete(labels = c("Control", "20 kHz")) +
  theme(legend.position = "none")  

```

```{r}
spore_settlement_alaria = (alaria_trial1_2_graph | alaria_trial3_4_graph) / (combined_graph)
spore_settlement_alaria+ plot_annotation(tag_levels = 'A')

```





###SPECIES COMPARISON

```{r}
all_data = read.csv("data/all_settlement_data.csv")

  ggplot(all_data, aes(x = Label.B, y = Settlement, fill = Label.B)) + 
  geom_point(aes(colour = Label.B), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.7) +
  theme_classic() +
  labs(x = "Treatment", y = "Settlement") +
  theme(axis.title = element_text(size = 10)) +
  theme(legend.position = "none")
```

```{r}
all_data = read.csv("data/all_valid_data.csv")

  ggplot(all_data, aes(x = Species, y = Settlement, fill = Species)) + 
  geom_point(aes(colour = Species), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.7) +
  theme_classic() +
  labs(x = "Species", y = "Total Settlement") +
  theme(axis.title = element_text(size = 10)) +
  scale_x_discrete(labels = c(expression(paste(italic("Alaria marginata")), italic("Macrocystis pyrifera")))) +
  theme(legend.position = "none")
```

## Checking for significant difference between controls 
Treatment - control v sound
filter the data to only show sound

```{r}
# Treatment
only_sound_both_species <- all_data %>%
  filter(Treatment == "Sound", .preserve = FALSE) %>%
  subset(select = c(Settlement, Species))

# Control
only_control_both_species <- all_data %>%
  filter(Treatment == "Control", .preserve = FALSE) %>%
  subset(select = c(Settlement, Species))
```

```{r}
shapiro.test(only_sound_both_species$Settlement)
```
W = 0.76574, p-value = 4.548e-08
NOT NORMAL

*TRY TRANSFORMING DATA FIRST!! BEFORE MODELLING

```{r}
shapiro.test(only_control_both_species$Settlement)
```
W = 0.82702, p-value = 1.347e-06
NOT NORMAL



-----------------------------------------------------------------------------

### GERMINATION ANALYSIS

```{r}
alaria_germination_all <- read.csv("data/alaria_germination.csv")
```

```{r}
my_cols4 = c("A Control" = "purple1", "A Treatment" = "purple2", 
             "B Control" = "lightgoldenrod1", "B Treatment" = "lightgoldenrod2")

my_x_title_2 = expression(paste(italic("Alaria marginata"), " Treatments"))

ggplot(alaria_germination_all, aes(x = Treatment, y = Ratio, fill = Treatment)) + 
  geom_point(aes(colour = Treatment), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.5) +
  scale_color_manual(values = my_cols4) +
  scale_fill_manual(values = my_cols4) + 
  theme_classic() +
  labs(x = my_x_title_2, y = "Percent spores germinated") +
  theme(axis.title = element_text(size = 13)) +
  scale_x_discrete(labels = c("Control 1", "Treatment 1", 
                              "Control 2", "Treatment 2"))

```


### GERMINATING Analysis

```{r}
alaria_germination_trial_1 <- alaria_germination_all %>%
  filter(Treatment == "A Control" | Treatment == "A Treatment", .preserve = FALSE) 

alaria_germination_trial_2 <- alaria_germination_all %>%
  filter(Treatment == "B Control" | Treatment == "B Treatment", .preserve = FALSE)
```


```{r}
# testing for normality in trial 1
shapiro.test(alaria_germination_trial_1$Ratio)
# W = 0.99187, p-value = 0.709 -> NORMAL

# testing for normality in trial 2
shapiro.test(alaria_germination_trial_2$Ratio)
# W = 0.99403, p-value = 0.896 -> NORMAL

```



```{r}
# running a linear model on trial 1 germination proportion - assuming normality
# numerical and categorical variable (ratio and treatment respectively)
alaria_germinating_trial1.mod <- lm(Ratio ~ Treatment, 
                      data = alaria_germination_trial_1)
summary(alaria_germinating_trial1.mod)
```
Adjusted R-squared:  0.01117 
F-statistic: 2.344 on 1 and 118 DF,  p-value: 0.1284


```{r}
# running a linear model on trial 2 germination proportion - assuming normality
alaria_germinating_trial2.mod <- lm(Ratio ~ Treatment, 
                      data = alaria_germination_trial_2)
summary(alaria_germinating_trial2.mod)
```
Adjusted R-squared:  0.1071 
F-statistic: 15.15 on 1 and 117 DF,  p-value: 0.0001658


```{r}
var.test(Ratio ~ Treatment, alaria_germination_trial_1, 
         alternative = "two.sided")
# p-value = 0.9122
         
var.test(Ratio ~ Treatment, alaria_germination_trial_2, 
         alternative = "two.sided")
# p-value = 0.8049
         
```


