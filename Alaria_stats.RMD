
### Loading Libraries 
```{r}
library(ggplot2)
library(tidyverse)
library(DHARMa)
library(mgcv)
library(fitdistrplus)
library(goft)
library(gamlss)
library(patchwork)
library(MASS)
# do i need all of these?
```


### ALARIA ###

### SPORE SETTLEMENT TRIAL 1

```{r}
# loading all alaria measurements 
alaria_trial_all_data = read.csv("data/alaria_trials_combined.csv")

# parsing data such that only trial 1 is present 
    # Note: trial one is now the combination of trial 1 and trial 2 because they
          # both used the same batch of spores
alaria_trial1_2_data <- alaria_trial_all_data %>%
  filter(Trial == "1" | Trial == "2", .preserve = FALSE)

```

```{r}
my_cols1 = c("Sound" = "khaki2", "Control" = "indianred3")

ggplot(alaria_trial1_2_data, aes(x = Treatment,
                                                     y = Settlement, fill = Treatment)) + 
  geom_point(aes(colour = Treatment), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.7) +
  scale_color_manual(values = my_cols1) +
  scale_fill_manual(values = my_cols1) + 
  theme_classic() +
  labs(x = "Trial 1", y = "Spore Settlement") +
  theme(axis.title = element_text(size = 10)) +
  scale_x_discrete(labels = c("Control", "20 kHz")) +
  theme(legend.position = "none") 

```

```{r}
alaria_trial1.mod <- lm(Settlement ~ Treatment, data = alaria_trial1_2_data)
summary(alaria_trial1.mod)
```
Adjusted R-squared:  0.1629 
F-statistic: 5.474 on 1 and 22 DF,  p-value: 0.02878

               Estimate Std. Error t value Pr(>|t|)    
(Intercept)      14.975      1.534   9.762 1.87e-09 ***
TreatmentSound    4.396      1.879   2.340   0.0288 * 

```{r}
shapiro.test(alaria_trial1_2_data$Settlement)
```
W = 0.99451, p-value = 1
NORMAL

```{r}
t.test(Settlement ~ Treatment, data = alaria_trial1_2_data, 
       alternative = "two.sided", var.equal = T, conf.level = 0.95)

# assuming normality testing similarity of means
```
t = -2.3397, df = 22, p-value = 0.02878
95 percent confidence interval: -8.2921577  -0.4995089
mean in group Control   mean in group Sound 
             14.97500              19.37083 
                        
```{r}
# Running a Two-Factor anova 
# ask if unnessecary due to linear model giving mostly same info
alaria_trial1.aov <- aov(Settlement ~ Treatment, data = alaria_trial1_2_data)
summary(alaria_trial1.aov)
```
            Df Sum Sq Mean Sq F value Pr(>F)  
Treatment    1  103.1  103.06   5.474 0.0288 *
Residuals   22  414.2   18.83

```{r}
# testing for variance
var.test(Settlement ~ Treatment, data = alaria_trial1_2_data, 
         alternative = "two.sided")
```
F = 1.2111, num df = 7, denom df = 15, p-value = 0.7103
95 percent confidence interval: 0.3677548 5.5322698
ratio of variances: 1.211149 


### ALARIA SETTLEMENT TRIAL 2

```{r}
alaria_trial_all_data = read.csv("data/alaria_trials_combined.csv")

alaria_trial3_4_data <- alaria_trial_all_data %>%
  filter(Trial == "3" | Trial == "4", .preserve = FALSE)

```

```{r}
my_cols2 = c("Sound" = "khaki2", "Control" = "indianred3")

ggplot(alaria_trial3_4_data, aes(x = Treatment, 
                                 y = Settlement, fill = Treatment)) + 
  geom_point(aes(colour = Treatment), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.7) +
  scale_color_manual(values = my_cols2) +
  scale_fill_manual(values = my_cols2) + 
  theme_classic() +
  labs(x = "Trial 2", y = "Spore Settlement") +
  theme(axis.title = element_text(size = 10)) +
  scale_x_discrete(labels = c("Control", "20 kHz")) +
  theme(legend.position = "none") 
  
```

```{r}
alaria_trial2.mod <- lm(Settlement ~ Treatment, data = alaria_trial3_4_data)
summary(alaria_trial2.mod)
```
Adjusted R-squared:  0.1269 
F-statistic: 4.343 on 1 and 22 DF,  p-value: 0.049

               Estimate Std. Error t value Pr(>|t|)    
(Intercept)      12.800      1.164  10.992  2.1e-10 ***
TreatmentSound    2.972      1.426   2.084    0.049 * 

```{r}
shapiro.test(alaria_trial3_4_data$Settlement)
```
W = 0.94019, p-value = 0.1648
normal


```{r}
t.test(Settlement ~ Treatment, data = alaria_trial3_4_data, 
       alternative = "two.sided", var.equal = T, conf.level = 0.95)

# assuming normality testing similarity of means
```
t = -2.0839, df = 22, p-value = 0.049
95 percent confidence interval:  -5.929492 -0.014258
mean in group Control   mean in group Sound 
             12.80000              15.77187
                     
                        
```{r}
alaria_trial2.aov <- aov(Settlement ~ Treatment, data = alaria_trial3_4_data)
summary(alaria_trial2.aov)
```
            Df Sum Sq Mean Sq F value Pr(>F)  
Treatment    1   47.1   47.10   4.343  0.049 *
Residuals   22  238.6   10.85   

```{r}
var.test(Settlement ~ Treatment, data = alaria_trial3_4_data, 
         alternative = "two.sided")
```
F = 0.35858, num df = 7, denom df = 15, p-value = 0.1751
95 percent confidence interval: 0.1088801 1.6379241
ratio of variances: 0.3585815 


----------------------------------------------------------------------------

IGNORE!!!
### ALARIA SETTLEMENT TRIAL 3

```{r}
alaria_trial_all_data = read.csv("data/alaria_trials_combined.csv")

alaria_trial3_data <- alaria_trial_all_data %>%
  filter(Trial == "3", .preserve = FALSE)

```

```{r}
my_cols1 = c("Sound" = "khaki2", "Control" = "indianred3")

ggplot(alaria_trial3_data, aes(x = Treatment, y = Settlement, fill = Treatment)) + 
  geom_point(aes(colour = Treatment), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.7) +
  scale_color_manual(values = my_cols1) +
  scale_fill_manual(values = my_cols1) + 
  theme_classic() +
  labs(x = "Trial 3", y = "Spore Settlement") +
  theme(axis.title = element_text(size = 10)) +
  scale_x_discrete(labels = c("Control", "20 kHz")) +
  theme(legend.position = "none") 
  
```

```{r}
alaria_trial3.mod <- lm(Settlement ~ Treatment, data = alaria_trial3_data)
summary(alaria_trial3.mod)
```
Adjusted R-squared:  0.115 
F-statistic: 2.949 on 1 and 14 DF,  p-value: 0.108

               Estimate Std. Error t value Pr(>|t|)    
(Intercept)      12.800      1.047  12.220 7.41e-09 ***
TreatmentSound    2.544      1.481   1.717    0.108  

```{r}
shapiro.test(alaria_trial3_data$Settlement)
```
W = 0.93167, p-value = 0.259
normal

```{r}
t.test(Settlement ~ Treatment, data = alaria_trial3_data, 
       alternative = "two.sided", var.equal = T, conf.level = 0.95)

# assuming normality testing similarity of means
```
t = -1.7172, df = 14, p-value = 0.108
95 percent confidence interval:
 -5.7209272  0.6334272
mean in group Control   mean in group Sound 
             12.80000              15.34375 
                     
                        
```{r}
alaria_trial3.aov <- aov(Settlement ~ Treatment, data = alaria_trial3_data)
summary(alaria_trial3.aov)
```
            Df Sum Sq Mean Sq F value Pr(>F)
Treatment    1  25.88  25.883   2.949  0.108
Residuals   14 122.89   8.778 

```{r}
var.test(Settlement ~ Treatment, data = alaria_trial3_data, 
         alternative = "two.sided")
```
F = 0.38577, num df = 7, denom df = 7, p-value = 0.2321
95 percent confidence interval:0.07723239   1.92687995
ratio of variances: 0.3857688 


----------------------------------------------------------------------------

### ALARIA SETTLEMENT TRIAL 4

```{r}
alaria_trial_all_data = read.csv("data/alaria_trials_combined.csv")

alaria_trial4_data <- alaria_trial_all_data %>%
  filter(Trial == "4", .preserve = FALSE)

```

```{r}
my_cols1 = c("Sound" = "khaki2", "Control" = "indianred3")

ggplot(alaria_trial4_data, aes(x = Treatment, y = Settlement, fill = Treatment)) + 
  geom_point(aes(colour = Treatment), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.7) +
  scale_color_manual(values = my_cols1) +
  scale_fill_manual(values = my_cols1) + 
  theme_classic() +
  labs(x = "Trial 4", y = "Spore Settlement") +
  theme(axis.title = element_text(size = 10)) +
  scale_x_discrete(labels = c("Control", "20 kHz")) +
  theme(legend.position = "none") 
  
```

```{r}
alaria_trial4.mod <- lm(Settlement ~ Treatment, data = alaria_trial4_data)
summary(alaria_trial4.mod)
```
Adjusted R-squared:  0.1849 
F-statistic: 4.403 on 1 and 14 DF,  p-value: 0.0545

               Estimate Std. Error t value Pr(>|t|)    
(Intercept)      12.800      1.146  11.172 2.33e-08 ***
TreatmentSound    3.400      1.620   2.098   0.0545 

```{r}
shapiro.test(alaria_trial4_data$Settlement)
```
W = 0.92744, p-value = 0.222
normal

```{r}
t.test(Settlement ~ Treatment, data = alaria_trial4_data, 
       alternative = "two.sided", var.equal = T, conf.level = 0.95)

# assuming normality testing similarity of means
```
t = -2.0983, df = 14, p-value = 0.0545
95 percent confidence interval: -6.87529303  0.07529303
mean in group Control   mean in group Sound 
                 12.8                  16.2 
                     
                        
```{r}
alaria_trial4.aov <- aov(Settlement ~ Treatment, data = alaria_trial4_data)
summary(alaria_trial4.aov)
```
            Df Sum Sq Mean Sq F value Pr(>F)  
Treatment    1  46.24   46.24   4.403 0.0545 .
Residuals   14 147.03   10.50                 

```{r}
var.test(Settlement ~ Treatment, data = alaria_trial4_data, 
         alternative = "two.sided")
```
F = 0.30322, num df = 7, denom df = 7, p-value = 0.1381
95 percent confidence interval:0.06070511  1.51453904
ratio of variances: 0.3032165 

----------------------------------------------------------------------

### COMBINED DATA 
```{r}
alaria_trial_all_data = read.csv("data/alaria_trials_combined.csv")

alaria_trial_all.mod <- lm(Settlement ~ Treatment, data = alaria_trial_all_data)
summary(alaria_trial_all.mod)
```
Adjusted R-squared:  0.139 
F-statistic: 8.588 on 1 and 46 DF,  p-value: 0.005253

               Estimate Std. Error t value Pr(>|t|)    
(Intercept)      13.887      1.026  13.531  < 2e-16 ***
TreatmentSound    3.684      1.257   2.931  0.00525 **

```{r}
shapiro.test(alaria_trial_all_data$Settlement)
```
W = 0.97504, p-value = 0.3925
normal

```{r}
t.test(Settlement ~ Treatment, data = alaria_trial_all_data, 
       alternative = "two.sided", var.equal = T, conf.level = 0.95)

# assuming normality testing similarity of means
```
t = -2.9306, df = 46, p-value = 0.005253
95 percent confidence interval: -6.214167 -1.153542
sample estimates:
mean in group Control   mean in group Sound 
             13.88750              17.57135 
                     

```{r}
var.test(Settlement ~ Treatment, data = alaria_trial_all_data, 
         alternative = "two.sided")
```
F = 0.73148, num df = 15, denom df = 31, p-value = 0.529
95 percent confidence interval:  0.3193237 1.9283757
ratio of variances: 0.7314804 

------------------------------------------------------------------------------

### ALL FOUR TRIALS IN ONE FIGURE

```{r}
library(patchwork)
library(ggplot2)

my_cols1 = c("Sound" = "khaki2", "Control" = "indianred3")

alaria_trial_all_data = read.csv("data/alaria_trials_combined.csv")

alaria_trial1_2_graph = ggplot(alaria_trial1_2_data, 
                             aes(x = Treatment, y = Settlement, fill = Treatment)) + 
  geom_point(aes(colour = Treatment), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.7) +
  scale_color_manual(values = my_cols1) +
  scale_fill_manual(values = my_cols1) + 
  theme_classic() +
  labs(x = "Trial 1", y = "Spore Settlement") +
  theme(axis.title = element_text(size = 13)) +
  scale_x_discrete(labels = c("Control", "20 kHz")) +
  theme(legend.position = "none") 

alaria_trial3_4_graph = ggplot(alaria_trial3_4_data, 
                             aes(x = Treatment, y = Settlement, fill = Treatment)) + 
  geom_point(aes(colour = Treatment), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.7) +
  scale_color_manual(values = my_cols1) +
  scale_fill_manual(values = my_cols1) + 
  theme_classic() +
  labs(x = "Trial 2", y = "Spore Settlement") +
  theme(axis.title = element_text(size = 13)) +
  scale_x_discrete(labels = c("Control", "20 kHz")) +
  theme(legend.position = "none") 


combined_graph = ggplot(alaria_trial_all_data, aes(x = Treatment, y = Settlement, fill = Treatment)) + 
  geom_point(aes(colour = Treatment), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.7) +
  scale_color_manual(values = my_cols1) +
  scale_fill_manual(values = my_cols1) + 
  theme_classic() +
  labs(x = "Alaria marginata Combined Data", y = "Spore Settlement") +
  theme(axis.title = element_text(size = 13)) +
  scale_x_discrete(labels = c("Control", "20 kHz")) +
  theme(legend.position = "none")  

```

```{r}
spore_settlement_alaria = (alaria_trial1_2_graph | alaria_trial3_4_graph) / (combined_graph)
spore_settlement_alaria+ plot_annotation(tag_levels = 'A')

```





###SPECIES COMPARISON

```{r}
all_data = read.csv("data/all_valid_data.csv")

  ggplot(all_data, aes(x = Label.B, y = Settlement, fill = Label.B)) + 
  geom_point(aes(colour = Label.B), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.7) +
  theme_classic() +
  labs(x = "Treatment", y = "Settlement") +
  theme(axis.title = element_text(size = 10)) +
  theme(legend.position = "none")
```

```{r}
all_data = read.csv("data/all_valid_data.csv")

  ggplot(all_data, aes(x = Species, y = Settlement, fill = Species)) + 
  geom_point(aes(colour = Species), position = position_jitterdodge()) +
  geom_boxplot(alpha = 0.7) +
  theme_classic() +
  labs(x = "Species", y = "Total Settlement") +
  theme(axis.title = element_text(size = 10)) +
  scale_x_discrete(labels = c(expression(paste(italic("Alaria marginata")), italic("Macrocystis pyrifera")))) +
  theme(legend.position = "none")
```

## Checking for significant difference between controls 
Treatment - control v sound
filter the data to only show sound

```{r}
# Treatment
only_sound_both_species <- all_data %>%
  filter(Treatment == "Sound", .preserve = FALSE) %>%
  subset(select = c(Settlement, Species))

# Control
only_control_both_species <- all_data %>%
  filter(Treatment == "Control", .preserve = FALSE) %>%
  subset(select = c(Settlement, Species))
```

```{r}
shapiro.test(only_sound_both_species$Settlement)
```
W = 0.76574, p-value = 4.548e-08
NOT NORMAL

*TRY TRANSFORMING DATA FIRST!! BEFORE MODELLING

```{r}
shapiro.test(only_control_both_species$Settlement)
```
W = 0.82702, p-value = 1.347e-06
NOT NORMAL

